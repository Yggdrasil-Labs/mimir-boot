version: 2
updates:
  # Maven 依赖更新
  - package-ecosystem: "maven"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 10
    reviewers:
      - "yggdrasil-labs"
    assignees:
      - "yggdrasil-labs"
    commit-message:
      prefix: "chore"
      include: "scope"
    labels:
      - "📦 deps"
    # 忽略主要版本更新（破坏性变更）
    ignore:
      # Spring Boot 主要版本更新需要手动处理
      - dependency-name: "org.springframework.boot:spring-boot-dependencies"
        update-types: ["version-update:semver-major"]
      # Spring Cloud 主要版本更新
      - dependency-name: "org.springframework.cloud:spring-cloud-dependencies"
        update-types: ["version-update:semver-major"]
      # Spring Cloud Alibaba 主要版本更新
      - dependency-name: "com.alibaba.cloud:spring-cloud-alibaba-dependencies"
        update-types: ["version-update:semver-major"]
      # MyBatis Plus 主要版本更新
      - dependency-name: "com.baomidou:mybatis-plus-boot-starter"
        update-types: ["version-update:semver-major"]
      # 数据库驱动主要版本更新
      - dependency-name: "com.mysql:mysql-connector-j"
        update-types: ["version-update:semver-major"]
      - dependency-name: "org.postgresql:postgresql"
        update-types: ["version-update:semver-major"]
      # 消息队列主要版本更新
      - dependency-name: "org.apache.rocketmq:rocketmq-spring-boot-starter"
        update-types: ["version-update:semver-major"]
      # 搜索引擎主要版本更新
      - dependency-name: "org.elasticsearch.client:elasticsearch-java"
        update-types: ["version-update:semver-major"]
      - dependency-name: "org.mongodb:mongodb-driver-sync"
        update-types: ["version-update:semver-major"]
      # Java 版本相关更新
      - dependency-name: "org.apache.maven.plugins:maven-compiler-plugin"
        update-types: ["version-update:semver-major"]
    # 允许的更新类型
    allow:
      - dependency-type: "direct"
      - dependency-type: "indirect"
    # 分组相关依赖
    groups:
      # Spring 生态
      spring-ecosystem:
        patterns:
          - "org.springframework.boot:*"
          - "org.springframework.cloud:*"
          - "org.springframework.security:*"
          - "com.alibaba.cloud:*"
        update-types: ["minor", "patch"]
      # 数据库相关
      database:
        patterns:
          - "com.mysql:*"
          - "org.postgresql:*"
          - "com.zaxxer:*"
          - "com.baomidou:*"
        update-types: ["minor", "patch"]
      # 测试框架
      testing:
        patterns:
          - "org.junit.jupiter:*"
          - "org.mockito:*"
          - "org.testcontainers:*"
        update-types: ["minor", "patch"]
      # 工具类
      utilities:
        patterns:
          - "org.projectlombok:*"
          - "cn.hutool:*"
          - "com.alibaba.fastjson2:*"
          - "com.fasterxml.jackson.*:*"
        update-types: ["minor", "patch"]
      # 监控和安全
      monitoring-security:
        patterns:
          - "io.micrometer:*"
          - "io.jsonwebtoken:*"
        update-types: ["minor", "patch"]
      # 消息队列
      messaging:
        patterns:
          - "org.springframework.kafka:*"
          - "org.apache.rocketmq:*"
        update-types: ["minor", "patch"]
      # 搜索引擎和NoSQL
      search-nosql:
        patterns:
          - "org.elasticsearch.client:*"
          - "org.mongodb:*"
        update-types: ["minor", "patch"]
      # 定时任务
      scheduling:
        patterns:
          - "com.xuxueli:*"
        update-types: ["minor", "patch"]
      # 分布式缓存
      caching:
        patterns:
          - "com.alicp.jetcache:*"
        update-types: ["minor", "patch"]
      # Maven 插件
      maven-plugins:
        patterns:
          - "org.apache.maven.plugins:*"
          - "org.codehaus.mojo:*"
          - "org.springframework.boot:spring-boot-maven-plugin"
          - "org.jacoco:jacoco-maven-plugin"
          - "com.github.spotbugs:spotbugs-maven-plugin"
          - "org.codehaus.mojo:flatten-maven-plugin"
          - "org.sonarsource.scanner.maven:sonar-maven-plugin"
        update-types: ["minor", "patch"]

  # GitHub Actions 更新
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 5
    reviewers:
      - "yggdrasil-labs"
    assignees:
      - "yggdrasil-labs"
    commit-message:
      prefix: "ci"
      include: "scope"
    labels:
      - "🧰 infra"